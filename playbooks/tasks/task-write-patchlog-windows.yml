  - name: Prepare log file
    set_fact:
    log_string: |
        {% for host in groups['target_hosts'] %}
        ###########################################################################################################################

        {{ host }} ({{ ansible_facts.os_name }}):
        Updates({{ update_result.found_update_count }}):
        {% for update in update_result.updates %}
        - {{ update_result.updates[update].title }}
        {% endfor %}
        
        Done: Neustart von {{ reboot_start.stdout }} bis {{ reboot_end.stdout }} = OK
        ToDo: Festplattenspeicher {{ disk_space_gb }} GB =
        {{ windows_verson_check }}
        ToDo: WSUS Status prÃ¼fen =
        ToDo: Logs > Anwendung = 
        ToDo: Logs > System = 
        ToDo: Abmelden = 
        {% endfor %}
  - name: Write Windows patch log
    lineinfile:
      create: yes
      path: "/mnt/protokolle/{{ current_year }}/{{ current_month }}/Serverpatch/Fertig/Updates-{{ groupe_name }}-Generated.txt"
      line: "{{ log_string }}"

    delegate_to: localhost